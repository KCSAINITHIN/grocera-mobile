<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Up - GROCERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --mango: #FFBE0B;
      --orange: #FB5607;
      --pink: #FF006E;
      --purple: #8338EC;
      --blue: #3A86FF;
      --white: #FFFFFF;
      --dark: #121212;
      --glass: rgba(255, 255, 255, 0.15);
    }
    
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: 
        linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
        url('https://images.unsplash.com/photo-1490645935967-10de6ba17061?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2053&q=80') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--white);
      overflow: auto;
    }

    .signup-box {
      background: var(--glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-top: 4px solid var(--pink);
      padding: 30px 25px;
      border-radius: 16px;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(255, 0, 110, 0.3);
      width: 100%;
      max-width: 380px;
      text-align: center;
      position: relative;
      overflow: hidden;
      z-index: 1;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      margin: 20px;
      box-sizing: border-box;
    }

    .signup-box:hover {
      transform: translateY(-5px);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.4),
        0 0 30px rgba(255, 0, 110, 0.4);
    }

    .signup-box::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle, rgba(255,0,110,0.1) 0%, transparent 70%),
        radial-gradient(circle, rgba(251,86,7,0.1) 0%, transparent 70%);
      z-index: -1;
      animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
      100% { transform: rotate(360deg); }
    }

    .signup-box img {
      width: 150px;
      margin-bottom: 20px;
      filter: drop-shadow(0 0 10px rgba(255, 0, 110, 0.5));
    }

    .signup-box h2 {
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 28px;
      background: linear-gradient(90deg, var(--pink), var(--orange), var(--mango));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 15px rgba(255, 0, 110, 0.3);
    }

    .input-group {
      position: relative;
      margin-bottom: 15px;
    }

    .signup-box input {
      width: 100%;
      padding: 14px 16px;
      padding-right: 40px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.1);
      color: var(--white);
      box-sizing: border-box;
    }

    .signup-box input:focus {
      border-color: var(--pink);
      box-shadow: 0 0 0 3px rgba(255, 0, 110, 0.3);
      outline: none;
      background: rgba(255, 255, 255, 0.2);
    }

    .signup-box input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: rgba(255, 255, 255, 0.6);
      transition: all 0.3s ease;
    }

    .toggle-password:hover {
      color: var(--white);
    }

    .signup-box button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(45deg, var(--pink), var(--purple));
      color: var(--white);
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      margin-top: 10px;
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
    }

    .signup-box button:hover {
      background: linear-gradient(45deg, var(--purple), var(--pink));
      box-shadow: 0 8px 25px rgba(131, 56, 236, 0.6);
      transform: translateY(-3px);
    }

    .signup-box button:active {
      transform: translateY(1px);
    }

    .signup-box button:disabled {
      background: linear-gradient(45deg, #888, #555);
      cursor: not-allowed;
      transform: none;
    }

    .login-link {
      margin-top: 20px;
      font-size: 15px;
      color: rgba(255, 255, 255, 0.7);
    }

    .login-link a {
      color: var(--mango);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
    }

    .login-link a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--mango);
      transition: width 0.3s ease;
    }

    .login-link a:hover {
      color: var(--orange);
      text-shadow: 0 0 10px rgba(251, 86, 7, 0.5);
    }

    .login-link a:hover::after {
      width: 100%;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 14px;
      margin: -10px 0 15px 0;
      text-align: left;
      display: none;
    }

    .password-requirements {
      text-align: left;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 15px;
    }

    .password-requirements ul {
      padding-left: 20px;
      margin: 5px 0;
    }

    .requirement {
      transition: all 0.3s ease;
    }

    .requirement.met {
      color: var(--mango);
    }

    .terms-container {
      display: flex;
      align-items: flex-start;
      margin: 15px 0;
      text-align: left;
    }

    .terms-container input {
      width: auto;
      margin-right: 10px;
      margin-top: 3px;
    }

    .terms-container label {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
    }

    .terms-container a {
      color: var(--mango);
      text-decoration: none;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--white);
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (min-width: 768px) {
      .signup-box {
        padding: 40px 35px;
      }
      
      .signup-box img {
        width: 180px;
        margin-bottom: 25px;
      }
      
      .signup-box h2 {
        font-size: 32px;
        margin-bottom: 25px;
      }
      
      .signup-box input {
        padding: 14px 20px;
        font-size: 16px;
        margin-bottom: 18px;
      }
      
      .signup-box button {
        padding: 16px;
        font-size: 18px;
      }
      
      .login-link {
        font-size: 16px;
        margin-top: 25px;
      }
    }

    @media (max-width: 400px) {
      .signup-box {
        padding: 25px 20px;
      }
      
      .signup-box h2 {
        font-size: 24px;
      }
      
      .login-link {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="signup-box">
    <img src="logo.png" alt="GROCERA Logo">
    <h2>Join GROCERA</h2>
    <form id="signupForm">
      <div class="input-group">
        <input type="text" id="name" placeholder="Full Name" required>
      </div>
      <div id="nameError" class="error-message"></div>
      
      <div class="input-group">
        <input type="tel" id="mobile" placeholder="Mobile Number" maxlength="10" required>
      </div>
      <div id="mobileError" class="error-message"></div>
      
      <div class="input-group">
        <input type="email" id="email" placeholder="Email Address" required>
      </div>
      <div id="emailError" class="error-message"></div>
      
      <div class="input-group">
        <input type="password" id="password" placeholder="Create Password" required>
        <i class="fas fa-eye toggle-password" id="togglePassword"></i>
      </div>
      <div class="password-strength">
        <div class="strength-meter" id="strengthMeter"></div>
      </div>
      <div id="passwordError" class="error-message"></div>
      
      <div class="password-requirements">
        <p>Password must contain:</p>
        <ul>
          <li id="req-length" class="requirement">At least 6 characters</li>
          <li id="req-uppercase" class="requirement">One uppercase letter</li>
          <li id="req-number" class="requirement">One number</li>
          <li id="req-special" class="requirement">One special character</li>
        </ul>
      </div>
      
      <div class="terms-container">
        <input type="checkbox" id="terms" required>
        <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
      </div>
      <div id="termsError" class="error-message"></div>
      
      <button type="submit" id="signupButton">Create Account</button>
    </form>
    
    <div class="login-link">
      Already have an account? <a href="index.html">Login</a>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCFu2tKa7JszwPRE7dTrG9FEX3Giw-pavc",
      authDomain: "grocera-nithin.firebaseapp.com",
      projectId: "grocera-nithin",
      storageBucket: "grocera-nithin.firebasestorage.app",
      messagingSenderId: "824896008507",
      appId: "1:824896008507:web:136d071d696f9ff190071e"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM elements
    const signupForm = document.getElementById("signupForm");
    const nameInput = document.getElementById("name");
    const mobileInput = document.getElementById("mobile");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const togglePassword = document.getElementById("togglePassword");
    const signupButton = document.getElementById("signupButton");
    const termsCheckbox = document.getElementById("terms");

    // Error message elements
    const nameError = document.getElementById("nameError");
    const mobileError = document.getElementById("mobileError");
    const emailError = document.getElementById("emailError");
    const passwordError = document.getElementById("passwordError");
    const termsError = document.getElementById("termsError");

    // Password requirement elements
    const reqLength = document.getElementById("req-length");
    const reqUppercase = document.getElementById("req-uppercase");
    const reqNumber = document.getElementById("req-number");
    const reqSpecial = document.getElementById("req-special");

    // Toggle password visibility
    togglePassword.addEventListener("click", function() {
      const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
      this.classList.toggle("fa-eye-slash");
    });

    // Form submission handler
    signupForm.addEventListener("submit", async function(e) {
      e.preventDefault();
      
      // Reset error messages
      resetErrors();
      
      // Get form values
      const name = nameInput.value.trim();
      const mobile = mobileInput.value.trim();
      const email = emailInput.value.trim().toLowerCase();
      const password = passwordInput.value.trim();
      const termsAccepted = termsCheckbox.checked;

      // Validate inputs
      let isValid = true;

      // Name validation
      if (name.length < 3) {
        showError(nameError, "Name must be at least 3 characters");
        isValid = false;
      }

      // Mobile validation
      const mobileRegex = /^[6-9]\d{9}$/;
      if (!mobileRegex.test(mobile)) {
        showError(mobileError, "Enter a valid 10-digit mobile number starting with 6-9");
        isValid = false;
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showError(emailError, "Enter a valid email address");
        isValid = false;
      }

      // Password validation
      if (password.length < 6) {
        showError(passwordError, "Password must be at least 6 characters");
        isValid = false;
      }

      // Terms validation
      if (!termsAccepted) {
        showError(termsError, "You must accept the terms and conditions");
        isValid = false;
      }

      if (!isValid) return;

      // Update button state
      signupButton.innerHTML = '<span class="spinner"></span> Creating Account...';
      signupButton.disabled = true;

      try {
        // Check if email already exists
        const methods = await auth.fetchSignInMethodsForEmail(email);
        if (methods && methods.length > 0) {
          showError(emailError, "This email is already registered. Please login instead.");
          resetButton();
          return;
        }

        // Create user with Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Send email verification
        await user.sendEmailVerification();
        
        // Save additional user data to Firestore
        await db.collection("users").doc(user.uid).set({
          name: name,
          mobile: mobile,
          email: email,
          emailVerified: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Success
        signupButton.innerHTML = 'âœ“ Account Created!';
        signupButton.style.background = 'linear-gradient(45deg, var(--mango), var(--orange))';
        
        // Show success message
        alert(`Account created successfully!\n\nWe've sent a verification email to ${email}. Please verify your email to login.`);
        
        // Redirect to login page after delay
        setTimeout(() => {
          window.location.href = "index.html"; // Make sure this matches your login page filename
        }, 2000);
      } catch (error) {
        console.error("Signup error:", error);
        handleSignupError(error);
        resetButton();
      }
    });

    // Password input event listener for real-time validation
    passwordInput.addEventListener("input", function() {
      const password = this.value;
      
      // Update password strength meter
      updateStrengthMeter(password);
      
      // Update password requirements
      updatePasswordRequirements(password);
    });

    // Helper functions
    function resetErrors() {
      nameError.style.display = 'none';
      mobileError.style.display = 'none';
      emailError.style.display = 'none';
      passwordError.style.display = 'none';
      termsError.style.display = 'none';
    }

    function showError(element, message) {
      element.textContent = message;
      element.style.display = 'block';
    }

    function resetButton() {
      signupButton.innerHTML = 'Create Account';
      signupButton.disabled = false;
      signupButton.style.background = 'linear-gradient(45deg, var(--pink), var(--purple))';
    }

    function updateStrengthMeter(password) {
      const strengthMeter = document.getElementById("strengthMeter");
      let strength = 0;
      
      if (password.length > 0) strength += 20;
      if (password.length >= 6) strength += 20;
      if (/[A-Z]/.test(password)) strength += 20;
      if (/[0-9]/.test(password)) strength += 20;
      if (/[^A-Za-z0-9]/.test(password)) strength += 20;
      
      strengthMeter.style.width = strength + '%';
      
      // Update color based on strength
      if (strength < 40) {
        strengthMeter.style.background = '#ff0000';
      } else if (strength < 80) {
        strengthMeter.style.background = '#ff9900';
      } else {
        strengthMeter.style.background = '#33cc33';
      }
    }

    function updatePasswordRequirements(password) {
      // Length requirement
      if (password.length >= 6) {
        reqLength.classList.add('met');
      } else {
        reqLength.classList.remove('met');
      }
      
      // Uppercase requirement
      if (/[A-Z]/.test(password)) {
        reqUppercase.classList.add('met');
      } else {
        reqUppercase.classList.remove('met');
      }
      
      // Number requirement
      if (/[0-9]/.test(password)) {
        reqNumber.classList.add('met');
      } else {
        reqNumber.classList.remove('met');
      }
      
      // Special character requirement
      if (/[^A-Za-z0-9]/.test(password)) {
        reqSpecial.classList.add('met');
      } else {
        reqSpecial.classList.remove('met');
      }
    }

    function handleSignupError(error) {
      const errorCode = error.code;
      const errorMessage = getFriendlyError(errorCode);
      
      switch(errorCode) {
        case 'auth/email-already-in-use':
          showError(emailError, errorMessage);
          break;
        case 'auth/invalid-email':
          showError(emailError, errorMessage);
          break;
        case 'auth/weak-password':
          showError(passwordError, errorMessage);
          break;
        default:
          alert("Signup failed: " + errorMessage);
      }
    }

    function getFriendlyError(errorCode) {
      switch(errorCode) {
        case 'auth/email-already-in-use':
          return 'This email is already registered. Please login or use a different email.';
        case 'auth/invalid-email':
          return 'The email address is not valid. Please check and try again.';
        case 'auth/weak-password':
          return 'Password should be at least 6 characters and include a mix of letters, numbers, and symbols.';
        case 'auth/operation-not-allowed':
          return 'Account creation is currently disabled. Please contact support.';
        case 'auth/too-many-requests':
          return 'Too many attempts. Please try again later.';
        default:
          return errorCode ? errorCode : 'Unknown error occurred';
      }
    }
  </script>
</body>
</html>
